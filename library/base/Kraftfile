spec: v0.6

template:
  source: https://github.com/unikraft/app-elfloader.git
  version: stable

unikraft:
  source: https://github.com/unikraft/unikraft.git
  version: staging
  kconfig:
    CONFIG_APPELFLOADER_ARCH_PRCTL: 'y'
    CONFIG_APPELFLOADER_BRK: 'y'
    CONFIG_APPELFLOADER_CUSTOMAPPNAME: 'y'
    CONFIG_APPELFLOADER_STACK_NBPAGES: 128
    CONFIG_APPELFLOADER_VFSEXEC_EXECBIT: 'n'
    CONFIG_APPELFLOADER_VFSEXEC: 'y'
    CONFIG_HAVE_PAGING_DIRECTMAP: 'y'
    CONFIG_HAVE_PAGING: 'y'
    CONFIG_LIBDEVFS_AUTOMOUNT: 'y'
    CONFIG_LIBDEVFS_DEV_NULL: 'y'
    CONFIG_LIBDEVFS_DEV_STDOUT: 'y'
    CONFIG_LIBDEVFS_DEV_ZERO: 'y'
    CONFIG_LIBDEVFS: 'y'
    CONFIG_LIBISRLIB: 'y'
    CONFIG_LIBPOSIX_ENVIRON_ENVP0: "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    CONFIG_LIBPOSIX_ENVIRON_ENVP1: "LD_LIBRARY_PATH=/usr/local/lib:/usr/lib:/lib"
    CONFIG_LIBPOSIX_ENVIRON_ENVP2: "HOME=/"
    CONFIG_LIBPOSIX_ENVIRON: 'y'
    CONFIG_LIBPOSIX_EVENTFD: 'y'
    CONFIG_LIBPOSIX_FDIO: 'y'
    CONFIG_LIBPOSIX_FDTAB: 'y'
    CONFIG_LIBPOSIX_FUTEX: 'y'
    CONFIG_LIBPOSIX_MMAP: 'y'
    CONFIG_LIBPOSIX_NETLINK: 'y'
    CONFIG_LIBPOSIX_PIPE: 'y'
    CONFIG_LIBPOSIX_POLL: 'y'
    CONFIG_LIBPOSIX_PROCESS_CLONE: 'y'
    CONFIG_LIBPOSIX_SOCKET: 'y'
    CONFIG_LIBPOSIX_SYSINFO: 'y'
    CONFIG_LIBPOSIX_TIME: 'y'
    CONFIG_LIBPOSIX_TIMERFD: 'y'
    CONFIG_LIBPOSIX_UNIXSOCKET: 'y'
    CONFIG_LIBPOSIX_USER_GID: 0
    CONFIG_LIBPOSIX_USER_GROUPNAME: "root"
    CONFIG_LIBPOSIX_USER_UID: 0
    CONFIG_LIBPOSIX_USER_USERNAME: "root"
    CONFIG_LIBPOSIX_USER: 'y'
    CONFIG_LIBRAMFS: 'y'
    CONFIG_LIBSYSCALL_SHIM_HANDLER_ULTLS: 'y'
    CONFIG_LIBSYSCALL_SHIM_HANDLER: 'y'
    CONFIG_LIBSYSCALL_SHIM_LEGACY_VERBOSE: 'y'
    CONFIG_LIBSYSCALL_SHIM: 'y'
    CONFIG_LIBUKALLOCPOOL: 'y'
    CONFIG_LIBUKBLKDEV_SYNC_IO_BLOCKED_WAITING: 'y'
    CONFIG_LIBUKBLKDEV: 'y'
    CONFIG_LIBUKBOOT_BANNER_MINIMAL: 'y'
    CONFIG_LIBUKBOOT_HEAP_BASE: '0x400000000'
    CONFIG_LIBUKCPIO: 'y'
    CONFIG_LIBUKFALLOC: 'y'
    CONFIG_LIBUKMPI: 'n'
    CONFIG_LIBUKSIGNAL: 'y'
    CONFIG_LIBUKVMEM_DEFAULT_BASE: '0x0000001000000000'
    CONFIG_LIBUKVMEM_DEMAND_PAGE_IN_SIZE: 12
    CONFIG_LIBUKVMEM_PAGEFAULT_HANDLER_PRIO: 4
    CONFIG_LIBUKVMEM: 'y'
    CONFIG_LIBVFSCORE_AUTOMOUNT_ROOTFS: 'n'
    CONFIG_LIBVFSCORE_FSTAB: 'y'
    CONFIG_LIBVFSCORE_NONLARGEFILE: 'y'
    CONFIG_OPTIMIZE_DEADELIM: 'y'
    CONFIG_OPTIMIZE_LTO: 'y'
    CONFIG_PAGING: 'y'
    CONFIG_STACK_SIZE_PAGE_ORDER: 4 # 128 * 4K = 512K
    CONFIG_UKPLAT_KSP_SIZE: 32768
    CONFIG_UKPLAT_MEMREGION_MAX_COUNT: 64

    # Debug options
    CONFIG_KVM_DEBUG_VGA_CONSOLE: 'n'
    CONFIG_KVM_KERNEL_VGA_CONSOLE: 'n'
    CONFIG_LIBUKDEBUG_CRASH_SCREEN: 'n'
    CONFIG_LIBUKDEBUG_ENABLE_ASSERT: 'n'
    CONFIG_LIBUKDEBUG_PRINT_TIME: 'n'

    # CONFIG_LIBSYSCALL_SHIM_STRACE: 'y'
    # CONFIG_LIBUKDEBUG_PRINTD: 'y'
    # CONFIG_LIBUKDEBUG_PRINTK_INFO: 'y'

libraries:
  lwip: staging
  libelf: stable

targets:
- fc/x86_64
- qemu/x86_64
